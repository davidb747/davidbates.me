---
layout: article
title: WSL
permalink: /cheat_sheets/WSL.html
key: cheat-sheets-WSL
cover: /assets/images/technologies/wsl.png
---
## Issue with cached memory (vmemm RAM usage very high) [^1]

Open up a WSL terminal and check the memory by using the following command.

```bash
free -h
```

![WSL memory usage](/assets/images/wsl_cache.png)  

If the buff/cache is high (see screenshot above), it can be released by the following command (you need to be in root mode)

```bash
echo 1 > /proc/sys/vm/drop_caches
```

## Issue with WSL virtual disk taking up too much disk space

Follow tutorial [^2]

Notes on tutorial:

- Diskpart: I had to detach the virtual disk and attach it again as readonly before I could compact it. Otherwise I had the following error

>Virtual Disk Service Error - The VHDX is already attached

```bash
select vdisk file="..."
detach vdisk
attach vdisk readonly
compact vdisk
```

- After compacting virtual disk: detach and attach again, this time not readonly

```bash
detach vdisk
attach vdisk
```

- Docker engine was not restarting after I executed the compact commando, so I restarted PC after compacting the virtual disk. After that, the size of the virtual disk shrank 60 GB, and my docker was running again.

[^1]: [https://devblogs.microsoft.com](https://devblogs.microsoft.com/commandline/memory-reclaim-in-the-windows-subsystem-for-linux-2/#the-other-half-of-the-story-cached-memory)
[^2]: [https://stephenreescarter.net](https://stephenreescarter.net/how-to-shrink-a-wsl2-virtual-disk/)
